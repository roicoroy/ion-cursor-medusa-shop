<ion-header>
  <ion-toolbar>
    <ion-title>Review Step</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content class="ion-padding" *ngIf="viewState$ | async as vs">
  <!-- Customer Information -->
  <ion-card *ngIf="vs.customer">
    <ion-card-header>
      <ion-card-title>Customer Information</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Email:</strong> {{ vs.customer.email }}</p>
      <p><strong>Name:</strong> {{ vs.customer.first_name }} {{ vs.customer.last_name }}</p>
    </ion-card-content>
  </ion-card>

  <!-- Addresses (Summary) -->
  <ion-card *ngIf="vs.cart?.shipping_address">
    <ion-card-header>
      <ion-card-title>Shipping Address</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>{{ vs.cart.shipping_address?.first_name }} {{ vs.cart.shipping_address?.last_name }}</p>
      <p>{{ vs.cart.shipping_address.address_1 }} {{ vs.cart.shipping_address.address_2 }}</p>
      <p>{{ vs.cart.shipping_address.city }}, {{ vs.cart.shipping_address.postal_code }}</p>
      <p>{{ vs.cart.shipping_address.country_code | uppercase }}</p>
      <p>{{ vs.cart.shipping_address.phone }}</p>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="vs.cart?.billing_address">
    <ion-card-header>
      <ion-card-title>Billing Address</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>{{ vs.cart.billing_address?.first_name }} {{ vs.cart.billing_address?.last_name }}</p>
      <p>{{ vs.cart.billing_address.address_1 }} {{ vs.cart.billing_address.address_2 }}</p>
      <p>{{ vs.cart.billing_address.city }}, {{ vs.cart.billing_address.postal_code }}</p>
      <p>{{ vs.cart.billing_address.country_code | uppercase }}</p>
      <p>{{ vs.cart.billing_address.phone }}</p>
    </ion-card-content>
  </ion-card>

  <!-- Shipping Method Summary -->
  <ion-card *ngIf="selectedShippingMethod$ | async as shippingMethod">
    <ion-card-header>
      <ion-card-title>Shipping Method</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p><strong>{{ shippingMethod.shipping_option?.name }}</strong></p>
      <p>{{ shippingMethod.price / 100 | currency:vs.cart.currency_code }}</p>
    </ion-card-content>
  </ion-card>

  <!-- Payment Method Summary (Placeholder for now, actual payment method might be more complex) -->
  <ion-card *ngIf="vs.cart?.payment_sessions && vs.cart.payment_sessions.length > 0">
    <ion-card-header>
      <ion-card-title>Payment Method</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p><strong>{{ vs.cart.payment_sessions[0].provider_id | uppercase }}</strong></p>
      <!-- Display more details if available, e.g., last 4 digits of card -->
    </ion-card-content>
  </ion-card>

  <!-- Cart Summary -->
  <ion-card *ngIf="vs.cart">
    <ion-card-header>
      <ion-card-title>Order Summary</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let item of vs.cart.items">
          <ion-thumbnail slot="start">
            <ion-img [src]="item.thumbnail" (ionError)="onImageError($event)"></ion-img>
          </ion-thumbnail>
          <ion-label>
            <h3>{{ item.title }}</h3>
            <p>Quantity: {{ item.quantity }}</p>
            <p>Price: {{ item.unit_price / 100 | currency:vs.cart.currency_code }}</p>
          </ion-label>
        </ion-item>
      </ion-list>
      
      <ion-item>
        <ion-label>Subtotal</ion-label>
        <ion-note slot="end">{{ (vs.cart.subtotal || 0) / 100 | currency:vs.cart.currency_code }}</ion-note>
      </ion-item>
      
      <ion-item *ngIf="(vs.cart.shipping_total || 0) > 0">
        <ion-label>Shipping</ion-label>
        <ion-note slot="end">{{ (vs.cart.shipping_total || 0) / 100 | currency:vs.cart.currency_code }}</ion-note>
      </ion-item>
      
      <ion-item *ngIf="(vs.cart.tax_total || 0) > 0">
        <ion-label>Tax</ion-label>
        <ion-note slot="end">{{ (vs.cart.tax_total || 0) / 100 | currency:vs.cart.currency_code }}</ion-note>
      </ion-item>
      
      <ion-item>
        <ion-label><strong>Total</strong></ion-label>
        <ion-note slot="end"><strong>{{ (vs.cart.total || 0) / 100 | currency:vs.cart.currency_code }}</strong></ion-note>
      </ion-item>
    </ion-card-content>
  </ion-card>

  <ion-buttons>
    <ion-button (click)="goBack()" fill="outline">Previous</ion-button>
    <ion-button (click)="placeOrder()" expand="block">Place Order</ion-button>
  </ion-buttons>
</ion-content>